{% extends "base.html" %}
{% load static %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/home_logged.css' %}">
  <script defer src="{% static 'js/home_logged.js' %}"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="dashboard">
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-icon">üöÄ</div>
      <span class="logo-text">TaskFlow</span>
    </div>
    
    <nav class="menu">
      <ul>
        <li class="active"><i class="fas fa-users"></i> <span>–ì—Ä—É–ø–ø—ã</span></li>
        <li><i class="fas fa-tasks"></i> <span>–ó–∞–¥–∞—á–∏</span></li>
        <li><i class="fas fa-calendar-alt"></i> <span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></li>
      </ul>
    </nav>
    <div class="sidebar-footer">
      <div class="user-info dropdown">
        <div class="user-avatar">{{ user.username|slice:":1"|upper }}</div>
        <span class="username">{{ user.username }}</span>
        <div class="dropdown-menu">
          <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="logout-btn">–í—ã–π—Ç–∏</button>
          </form>
        </div>
      </div>
    </div>
  </aside>
  <main class="main-content">
    <header class="page-header">
      <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span class="highlight">{{ user.username }}</span></h1>
      <p class="subtitle">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</p>
    </header>
    <div class="stats-grid">
      <div class="stat-card neon-success">
        <div class="stat-icon">‚úî</div>
        <div class="stat-details">
          <span class="stat-label">–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
          <span class="stat-value" id="total-done">{{ total_done }}</span>
        </div>
      </div>

      <div class="stat-card neon-streak">
        <div class="stat-icon">üî•</div>
        <div class="stat-details">
          <span class="stat-label">–¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫</span>
          <span class="stat-value" id="current-streak">{{ current_streak }}</span>
        </div>
      </div>

      <div class="stat-card neon-warning">
        <div class="stat-icon">‚è∞</div>
        <div class="stat-details">
          <span class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
          <span class="stat-value" id="expired">{{ expired }}</span>
        </div>
      </div>
    </div>
    <div class="tasks-section">
      <div class="section-header">
        <h2>–í–∞—à–∏ –≥—Ä—É–ø–ø—ã</h2>
        <div class="actions">
          <button class="btn-primary"><i class="fas fa-plus"></i> –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</button>
        </div>
      </div>

      <div class="tasks-grid">
        {% for group, tasks in group_tasks.items %}
        <a href="{% url 'group_detail' group.id %}">
          <div class="task-group" data-group-id="{{ group.id }}">
            <div class="group-header">
              <h3>{{ group.name }}</h3>
              <span class="task-count">{{ tasks|length }}</span>
            </div>
            <div class="tasks-list">
              {% for task in tasks %}
              <div class="task-item">
                <div class="task-content">
                  <div class="task-title">{{ task.title }}</div>
                  <div class="task-meta">
                    {% if task.discipline %}<span class="discipline">{{ task.discipline }}</span>{% endif %}
                    {% if task.deadline %}<span class="deadline">–¥–æ {{ task.deadline|date:"d.m.Y" }}</span>{% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </a>
        {% endfor %}
      </div> 
    </div>
  </main>
</div>
{% endblock %}
