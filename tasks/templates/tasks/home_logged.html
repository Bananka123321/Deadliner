{% extends "base.html" %}
{% load static %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/home_logged.css' %}">
  <script defer src="{% static 'js/home_logged.js' %}"></script>
{% endblock %}

{% block content %}
<div class="dashboard">
  <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-icon">üöÄ</div>
      <span class="logo-text">TaskFlow</span>
    </div>
    
    <nav class="menu">
      <ul>
        <li class="active">
          <span>üè†</span> –î–∞—à–±–æ—Ä–¥
        </li>
        <li>
          <span>üë•</span> –ì—Ä—É–ø–ø—ã
        </li>
        <li>
          <span>üìù</span> –ó–∞–¥–∞—á–∏
        </li>
        <li>
          <span>‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        </li>
      </ul>
    </nav>
    
    <div class="sidebar-footer">
      <div class="user-info dropdown">
        <div class="user-avatar">{{ user.username|slice:":1"|upper }}</div>
        <span class="username">{{ user.username }}</span>
        <div class="dropdown-menu">
          <a href="{% url 'logout' %}" class="logout-btn">–í—ã–π—Ç–∏</a>
        </div>
      </div>
    </div>
  </aside>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="main-content">
    <header class="page-header">
      <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span class="highlight">{{ user.username }}</span></h1>
      <p class="subtitle">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</p>
    </header>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
      <div class="stat-card neon-success">
        <div class="stat-icon">‚úî</div>
        <div class="stat-details">
          <span class="stat-label">–í—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
          <span class="stat-value" id="total-done">{{ total_done }}</span>
        </div>
      </div>

      <div class="stat-card neon-streak">
        <div class="stat-icon">üî•</div>
        <div class="stat-details">
          <span class="stat-label">–¢–µ–∫—É—â–∏–π —Å—Ç—Ä–∏–∫</span>
          <span class="stat-value" id="current-streak">{{ current_streak }}</span>
        </div>
      </div>

      <div class="stat-card neon-warning">
        <div class="stat-icon">‚è∞</div>
        <div class="stat-details">
          <span class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</span>
          <span class="stat-value" id="expired">{{ expired }}</span>
        </div>
      </div>
    </div>

    <!-- –ó–∞–¥–∞—á–∏ -->
    <div class="tasks-section">
      <div class="section-header">
        <h2>–í–∞—à–∏ –∑–∞–¥–∞—á–∏</h2>
        <div class="actions">
          <button class="btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
        </div>
      </div>

      <div class="tasks-grid">
        {% for group, tasks in group_tasks.items %}
        <div class="task-group" data-group-id="{{ group.id }}">
          <div class="group-header">
            <h3>{{ group.name }}</h3>
            <span class="task-count">{{ tasks|length }}</span>
          </div>
          <div class="tasks-list">
            {% for task in tasks %}
            <div class="task-item">
              <div class="task-icon">üìå</div>
              <div class="task-content">
                <div class="task-title">{{ task.title }}</div>
                <div class="task-meta">
                  {% if task.discipline %}<span class="discipline">{{ task.discipline }}</span>{% endif %}
                  {% if task.deadline %}<span class="deadline">–¥–æ {{ task.deadline|date:"d.m.Y" }}</span>{% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %}

        {% if personal_tasks %}
        <div class="task-group personal">
          <div class="group-header">
            <h3>–õ–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏</h3>
            <span class="task-count">{{ personal_tasks|length }}</span>
          </div>
          <div class="tasks-list">
            {% for task in personal_tasks %}
            <div class="task-item">
              <div class="task-icon">üí´</div>
              <div class="task-content">
                <div class="task-title">{{ task.title }}</div>
                <div class="task-meta">
                  {% if task.deadline %}<span class="deadline">–¥–æ {{ task.deadline|date:"d.m.Y" }}</span>{% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </main>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
<div class="modal-overlay" id="taskModal">
  <div class="modal-content glassmorphism">
    <button class="modal-close">&times;</button>
    <h2 id="modal-title">–î–µ—Ç–∞–ª–∏ –≥—Ä—É–ø–ø—ã</h2>
    <div id="modal-tasks" class="modal-tasks-list"></div>
  </div>
</div>
{% endblock %}
